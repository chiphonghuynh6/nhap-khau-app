<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quản lý nhập khẩu</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-4">
  <div class="max-w-7xl mx-auto">
    <h1 class="text-2xl font-bold mb-4">Quản lý dữ liệu nhập khẩu</h1>

    <!-- Form nhập liệu -->
     <form id="importForm" class="grid grid-cols-1 md:grid-cols-3 gap-4 bg-white p-4 rounded shadow">
      <fieldset class="border p-4">
      <legend class="font-semibold">Thông tin chung</legend>
      <label>GET DOCS <input type="date" class="w-full p-2 border border-black rounded"/></label>
      <label>DEC NO: <input type="text"  class="w-full p-2 border border-black rounded"/></label>
      <label>FACT NO: 
        <select name="FACT no" class="w-full p-2 border border-black rounded"/>
          <option> </option><option>18A</option><option>B0SZ</option><option>B0M1</option><option>B0M2</option>
        </select>
      </label>
      <label>LOẠI HÌNH: 
        <select name="LOẠI HÌNH" class="w-full p-2 border border-black rounded"/>
          <option> </option><option>A12</option><option>E21</option><option>H11</option>
        </select>
      </label>
      <label>FWD: <input type="text" name="FWD" class="w-full p-2 border border-black rounded"/></label>
      <label>SUPPLIER: <input type="text" name="SUPPLIER" class="w-full p-2 border border-black rounded"/></label>
      <label>TYPE: 
        <select name="TYPE" class="w-full p-2 border border-black rounded"/>
          <option> </option><option>CONT</option><option>CFS</option><option>NGOAI QUAN</option>
          <option>BY TRUCK</option><option>DHL</option><option>AIR</option>
        </select>
      </label>
      <label>ORIGIN: <input type="text" name="ORIGIN" class="w-full p-2 border border-black rounded"/></label>
    </fieldset>

    <fieldset class="border p-4">
      <legend class="font-semibold">Thông tin vận đơn</legend>
      <label>BILL NO: <input type="text" name="BILL NO" class="w-full p-2 border border-black rounded"/></label>
      <label>BILL DATE: <input type="date" name="BILL DATE" class="w-full p-2 border border-black rounded"/></label>
      <label>PACKAGES: <input type="number" name="PACKAGES" class="w-full p-2 border border-black rounded"/></label>
      <label>GW: <input type="number" name="GW" class="w-full p-2 border border-black rounded"/></label>
      <label>CBM: <input type="number" name="CBM" class="w-full p-2 border border-black rounded"/></label>
      <label>CTN NO: <input type="text" name="CTN NO" class="w-full p-2 border border-black rounded"/></label>
	  <label>ETA DATEn: <input type="date" name="ETA DATE" class="w-full p-2 border border-black rounded"/></label>
      <label>ATC: <input type="date" name="ATC" class="w-full p-2 border border-black rounded"/></label>
    </fieldset>

    <fieldset class="border p-4">
      <legend class="font-semibold">Thông tin hóa đơn</legend>
      <label>INV NO: <input type="text" name="INV NO" class="w-full p-2 border border-black rounded"/></label>
      <label>INV DATE: <input type="date" name="INV DATE" class="w-full p-2 border border-black rounded"/></label>
      <label>AMOUNT: <input type="number" name="AMOUNT" class="w-full p-2 border border-black rounded"/></label>
      <label>TERM: 
        <select name="TERM" class="w-full p-2 border border-black rounded"/>
          <option> </option><option>CIF</option><option>FOB</option><option>C&F</option>
          <option>FCA</option><option>EXW</option><option>CPT</option>
          <option>DAT</option><option>DAP</option><option>CIP</option>
        </select></label>
      <label>File PDF: <input type="file" id="pdfFile" class="w-full p-2 border border-black rounded"/></label>
	   
      </fieldset>

      <button type="submit" class="col-span-2 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Thêm dữ liệu</button>
    </form>

    <!-- Bảng dữ liệu -->
    <div class="mt-8 bg-white rounded-lg shadow overflow-x-auto">
      <table class="min-w-full table-auto border">
        <thead class="bg-gray-200 text-gray-700">
          <tr id="tableHead"></tr>
        </thead>
        <tbody id="tableBody"></tbody>
      </table>
    </div>
  </div>

  <script>
    const API_URL = 'https://script.google.com/macros/s/AKfycbxH8EWMI0IBauWlA2kOIUDEWp6ldvJNrkYuUCHvRUQAOKOsZuP-AaviXe51ped0yOkqhw/exec';

    // Lấy dữ liệu từ Google Sheets
    async function loadData() {
      const res = await fetch(API_URL);
      const data = await res.json();
      renderTable(data);
    }

    function renderTable(data) {
      const thead = document.getElementById("tableHead");
      const tbody = document.getElementById("tableBody");
      tbody.innerHTML = '';
      thead.innerHTML = '';

      if (!data.length) return;

      // Header
      Object.keys(data[0]).forEach(key => {
        thead.innerHTML += `<th class="p-2 border">${key}</th>`;
      });

      // Dữ liệu
      data.forEach((row, idx) => {
        const tr = document.createElement('tr');
        Object.values(row).forEach(cell => {
          tr.innerHTML += `<td class="p-2 border">${cell}</td>`;
        });
        tbody.appendChild(tr);
      });
    }

    // Gửi dữ liệu mới lên Google Sheets
    document.getElementById("importForm").addEventListener("submit", async e => {
      e.preventDefault();
      const formData = new FormData(e.target);
      const data = {};
      for (let [key, value] of formData.entries()) {
        data[key] = value;
      }

      const payload = {
        action: 'add',
        data
      };

      const res = await fetch(API_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });

      const resultText = await res.text();
      alert(resultText);
      loadData(); // Làm mới bảng
      e.target.reset(); // Reset form
    });

    // Tải dữ liệu ngay khi trang tải xong
    loadData();
  </script>
</body>
</html>
